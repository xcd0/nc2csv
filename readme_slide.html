<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<script type="text/javascript" async
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async>
	</script>
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});
	</script>
	<style type="text/css">
	<!--
	/* builtin css*/
body{font-family:Helvetica,arial,sans-serif;font-size:3.5vmin;padding:0;margin:0;line-height:1.6;background-color:#fff;color:#444;word-wrap:break-word}body>:first-child{margin-top:0!important}body>:last-child{margin-bottom:0!important}a{color:#4183c4;text-decoration:none}a.absent{color:#c00}a.anchor{display:block;padding-left:30px;margin-left:-30px;cursor:pointer;position:absolute;top:0;left:0;bottom:0x}h1,h2,h3,h4,h5,h6{margin:20px 0 10px;padding:0;font-weight:700;-webkit-font-smoothing:antialiased;cursor:text;position:relative}h1:first-child,h1:first-child+h2,h2:first-child,h3:first-child,h4:first-child,h5:first-child,h6:first-child{margin-top:0;padding-top:0}h1:hover a.anchor,h2:hover a.anchor,h3:hover a.anchor,h4:hover a.anchor,h5:hover a.anchor,h6:hover a.anchor{text-decoration:none}h1 code,h1 tt,h2 code,h2 tt,h3 code,h3 tt,h4 code,h4 tt,h5 code,h5 tt,h6 code,h6 tt{font-size:inherit}h1{font-size:250%;margin-bottom:40px;padding-bottom:0}h1,h2{color:#000}h2{font-size:6vh;border-bottom:2px solid #ccc;margin-bottom:3%}h3{font-size:4vh;margin-top:-1.9%;border-bottom:1px solid #ddd;color:#555}h4{font-size:80%}h5{font-size:60%}h6{font-size:40%;color:#777}blockquote,dl,li,ol,p,pre,table{margin:2% 0}pre{white-space:pre-wrap}code{white-space:pre-wrap;word-wrap:break-word}li,ul{margin:.2em 0}hr{border:0 0 0;height:4px;padding:0}a:first-child h1,a:first-child h2,a:first-child h3,a:first-child h4,a:first-child h5,a:first-child h6,bo dy>h5:first-child,body>h1:first-child,body>h1:first-child+h2,body>h2:first-child,body>h3:first-child,body>h4:first-child,body>h6:first-child{margin-top:0;padding-top:0}h1 p,h2 p,h3 p,h4 p,h5 p,h6 p{margin-top:0}li p.first{display:inline-block}ol,ul{padding-left:30px}ol:first-child,ul:first-child{margin-top:0}dl,dl dt{padding:0}dl dt{font-size:14px;font-weight:700;font-weight:1400;font-style:italic;margin:15px 0 5px}dl dt:first-child{padding:0}dl dt>:first-child{margin-top:0}dl dt>:last-child{margin-bottom:0}dl dd{margin:0 0 15px;padding:0 15px}dl dd>:first-child{margin-top:0}dl dd>:last-child{margin-bottom:0}blockquote{border-left:4px solid #ddd;padding:0 15px;color:#777}blockquote>:first-child{margin-top:0}blockquote>:last-child{margin-bottom:0}table{padding:0;border-spacing:2px;border-collapse:collapse;max-width:90%;margin:auto}table,td,th{border:1px solid #ccc;font-size:90%}td,th{padding:0;margin:0}table tr{background-color:#fff;border-top:1px solid #c6cbd1;margin:0;padding:0}table tr:nth-child(2n){background-color:#f6f8fa}table tr th{font-weight:700;white-space:nowrap}table tr td,table tr th{border:1px solid #ccc;text-align:center;margin:0;padding:6px 13px}table tr td:first-child,table tr th:first-child{margin-top:0}img{max-height:100%;max-width:100%}code,tt{margin:1%;padding:.2% 1%;white-space:nowrap;border:1px solid #eaeaea;background-color:#f8f8f8;border-radius:3px}pre code{margin:0;padding:0;white-space:pre;border:0;background:0 0}.highlight pre,pre{border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}pre code,pre tt{background-color:transparent;border:0}.main-content{position:relative}.sub{position:absolute;padding:5vh 10vw;width:80vw;height:90vh;overflow-y:hidden}hr{border:0!important;color:#fff;height:4px}.page_num{border:0;position:absolute;right:10;bottom:10}.controller{width:50px;position:absolute;right:0;bottom:0}
	-->
	</style>
	<script type="text/javascript">
<!--
function goto(prev, next) {
	document.getElementById(prev).style.visibility = "hidden";
	document.getElementById(next).style.visibility = "visible";
}
var current_num;
var current;
function zeroPadding(num,length){
	return ('0000000000' + num).slice(-length);
}
function setPage(p,n){
	goto(p,n)
	location.hash = current_num;
}
function init(){
	var urlHash = location.hash.slice(1);
	if( urlHash == false ){
		current_num = zeroPadding(0,4);
	} else {
		if( isNaN(urlHash) ){
			current_num = "0000"
			location.hash = current_num;
		} else {
			current_num = zeroPadding(urlHash,4);
			var n = Number(current_num);
			if( n < 0 || n > 0 ){
				current_num = "0000"
				location.hash = current_num;
			}else{
			}
		}
	}
	current = "p" + String(current_num);
	main = document.getElementById("container");
	setPage( current, current )
}
function prev(){
	p = current
	if( current_num != "0000" ){
		current_num = zeroPadding( Number(current_num) - 1 ,4);
	}
	current = "p" + current_num;
	setPage( p, current )
}
function next(){
	p = current
	if( current_num != "0000" ){
		current_num = zeroPadding( Number(current_num) + 1 ,4);
	}
	current = "p" + current_num;
	setPage( p, current )
}
function resizeFontSize(p,r) {
	//p.style.fontSize = x + '%';
	p.style.zoom = r;
	p.style.MozTransform = r;
	p.style.WebkitTransform = r;
}
function checkSize(c){
	var r = document.getElementById(c).getBoundingClientRect();
	console.log(
		"cH : " + c.clientHeight
		+ "cRH : " + r.Height
		+ ", clientH : " + document.documentElement.clientHeight
	);
}
function shurinkPage(c){
	//checkSize(c);
	if( c.clientHeight > document.documentElement.clientHeight ){
		i= 0.95;
		resizeFontSize(c, i)
		for(
			;
			i > 0.7
			&& c.clientHeight > document.documentElement.clientHeight;
			i -= 0.01
		) {
			resizeFontSize(c, i);
			//checkSize(c);
		}
	}
}
window.addEventListener("click", function(e) {
	var w = window.innerWidth;
	const ratio = 0.1;
	var left = w * ratio;
	var right = w * ( 1 - ratio );
	//console.log("offset:" + e.offsetX + "," + e.offsetY);
	if( e.offsetX < left ){
		prev()
		console.log("offsetX :" + e.offsetX);
	} else if( e.offsetX > right ){
		next()
		console.log("offsetX :" + e.offsetX);
	}
});
var bool_ctrl_key = false;
var mousewheelevent = 'onwheel' in document ? 'wheel' : 'onmousewheel' in document ? 'mousewheel' : 'DOMMouseScroll';
try{
	document.addEventListener (mousewheelevent, onWheel, false);
}catch(e){
	//for legacy IE
	document.attachEvent ("onmousewheel", onWheel);
}
function onWheel(e) {
	if(!e) e = window.event; //for legacy IE
	//e.preventDefault();
	var delta = e.deltaY ? -(e.deltaY) : e.wheelDelta ? e.wheelDelta : -(e.detail);
	if( bool_ctrl_key === false ){
		if (delta < 0){
			//下にスクロールした場合の処理
			next();
		} else if (delta > 0){
			//上にスクロールした場合の処理
			prev();
		}
	}
}
function keydownfunc( event ) {
	var key_code = event.keyCode;
	if( bool_ctrl_key === false ){
		 if( key_code === 17 ) { bool_ctrl_key = true; } // ctrlキー
	}
	if( key_code === 33 ) { prev(); } // pageup
	if( key_code === 34 ) { next(); } // pagedown
	if( key_code === 37 ) { prev(); } // ←
	if( key_code === 38 ) { prev(); } // ↑
	if( key_code === 39 ) { next(); } // →
	if( key_code === 40 ) { next(); } // ↓
}
function keyupfunc( event ) {
	var key_code = event.keyCode;
	if( key_code === 17 ) { bool_ctrl_key = false; } // ctrlキー
}
window.onload = init;
var countInterval = 0;
addEventListener("keyup" , keyupfunc);
addEventListener("keydown", keydownfunc, false);
//window.addEventListener('load', resize, false);
//window.addEventListener('resize', resize, false);
//-->
</script>
</head>
<body>
<div id="container" class="main-content"><div id="p0000" id="container" class="sub" style="visibility: hidden;">
<!-- 自動生成されたプリアンブル ここから -->
<!-- // $width:"841.89" -->
<!-- // $height:"595.28" -->
<!-- // $page_number:"true" -->
<!-- // $page:"0" -->
<!-- // $absolute_page:"0" -->
<!-- // $h2:"実行" -->
<!-- // $h3:"入力ファイル形式" -->
<!-- // $title:"true" -->
<!-- // $state_title:"2" -->
<!-- 自動生成されたプリアンブル ここまで -->
<h1 id="ncプログラム分析器">NCプログラム分析器</h1>
<p>NCプログラムを読み込み、分析して、各軸座標位置、各行の送り速度、移動時間 を出力する。</p>
<ul>
<li>in : nc プログラム (テキストファイル、拡張子不定)<br />
</li>
<li>out : 1行ごとの各軸の動作、送り速度の解析結果 (csv または同等の表現をできる一般的なフォーマット)<br />
gui はつけてもつけなくてもいいが、必須ではない。</li>
</ul>
<p>出力データの1行 (解析用に項目追加可能性あり)</p>
<pre><code>元ncプログラムの行、XYZABC の各位置、プログラムの F、XYZABC の各軸速度、移動に要する時間  
</code></pre>
<p>初期値未指定などの場合は、わかりませんの意で不定値を書く。</p>
<p><code>./20191226_設計 #3206_ ncプログラム解析器 - 岡田 - CAM開発部.pdf</code> を元に作成する。</p>
<p>外部仕様書は<code>./specification.md</code>を見ること。</p>
<h2 id="windowsにおける環境設定">Windowsにおける環境設定</h2>
<ol>
<li><p>シェルを用意
なんでもよい。おおむね4パターン方法がある。</p>
<ul>
<li><p>Msys2(<a href="http://www.msys2.org/">http://www.msys2.org/</a>)</p>
<ol>
<li><a href="http://repo.msys2.org/distrib/x86_64/msys2-x86_64-20190524.exe">MSYS2 http://repo.msys2.org/distrib/x86_64/msys2-x86_64-20190524.exe</a> からダウンロードしてインストール。</li>
<li><code>pacman -Syuu</code> を実行し、アップデートする。</li>
<li>アップデート完了後、英語で一旦Msysを再起動せよとメッセージが出るので、<br />
ウィンドウを×ボタンで閉じて再度開く。</li>
<li><code>pacman -S git make wget</code> でgitとmakeを入れる。vimなど必要があれば入れる。</li>
</ol></li>
<li><p>WSL (StoreアプリからUbuntu等をインストールする)</p>
<ol>
<li>OSの初期設定は検索して行う。</li>
<li>初期設定が終わったら、gitとmake、wgetを入れる。<br />
ubuntuなら<code>sudo apt update</code> してパッケージリストをアップデートしたのちに <code>sudo apt install git make wget</code></li>
</ol></li>
<li><p>仮想マシン
お好きなようにどうぞ
対応しているOSはwindows, mac, linux, freeBSDです。</p></li>
<li><p>単純にインストール(お勧めしない)</p>
<ol>
<li>公式サイトからインストーラーをインストール。</li>
<li>コマンドプロンプトやPowershellなどで利用する。(これがしんどい)</li>
</ol></li>
</ul></li>
<li><p>Goのコンパイラのインストール</p>
<p>./go_compiler_install.sh というシェルスクリプトを用意しているので実行する。</p>
<ul>
<li><p><code>./go_compiler_install.sh -v go1.13.6 -f -p</code> で $HOME/work/go 以下にインストールされる。<br />
インストール先を変えたい場合は <code>./go_compiler_install.sh -h</code> でヘルプを見ること。</p>
<ul>
<li>インストールが終わったら<code>source .bashrc</code>などを実行するか、シェルを再起動すること。<br />
環境変数を読み込む必要がある。</li>
</ul></li>
<li><p>オプションが不明な場合、引数なしで<code>./go_compiler_install.sh</code> のようにたたけばヘルプが出る。</p></li>
<li><p><code>./go_compiler_install.sh -i</code> で対話的にインストールできる。</p></li>
</ul></li>
</ol>
<h2 id="ビルド">ビルド</h2>
<p>Goは基本的に <code>go build</code> だけでビルドできる。
この場合main関数のあるディレクトリの名前で実行ファイルが生成される。</p>
<p>更にMakefileも用意しているので <code>make</code> でもビルドできる。
Makefileでは、 生成される実行ファイルをソースコードから分けて生成したかったので、
別ディレクトリに生成するようにしている。</p>
<ol>
<li><p>ソースコードは各プログラムのディレクトリ内にsrcディレクトリがあり、そこにまとめている。
このsrcディレクトリにカレントディレクトリを移す。</p></li>
<li><p>makefileを用意しているので <code>make</code> すればビルドできる。</p></li>
<li><p>../build ディレクトリに実行ファイルができる。
<code>make run</code> で一応src/testにあるNCテキストファイルを使って実行する。</p></li>
</ol>
<h3 id="ビルドと実行の例">ビルドと実行の例</h3>
<p>例えばNCをGoのソースコードに変換していたプログラムは./nc2go/srcにある。</p>
<ol>
<li><code>cd ./nc2go/src</code></li>
<li><code>make</code><br />
これで./nc2go/buildに実行ファイルが生成される。</li>
<li><code>make run</code><br />
これでmakefileに書いてある適当なNCプログラムが変換され、出力される。</li>
</ol>
<h2 id="実行">実行</h2>
<p>現状第一引数にNCの書かれたテキストファイルを与えると実行する。</p>
<p>NCプログラムの書かれたテキストファイルを実行ファイルにD&amp;Dしてもよい。</p>
<h3 id="入力ファイル形式">入力ファイル形式</h3>
<p>文字コードはBOMなしUTF-8を推奨。
改行コードはLFを推奨。</p>
</div>
</div></body>
</html>
